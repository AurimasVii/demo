<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Secret</title>
  <style>
    body {
      background: #f9fbfd;
      font-family: 'Inter', 'Segoe UI', 'Roboto', Arial, sans-serif;
      color: #23272f;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .admin-container {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 18px rgba(0,0,0,0.06);
      padding: 2.5vw 5vw;
      max-width: 350px;
      width: 100%;
      text-align: center;
    }
    input[type="password"] {
      padding: 0.7em 1em;
      border-radius: 8px;
      border: 1px solid #e0e7ef;
      font-size: 1em;
      outline: none;
      margin-bottom: 1em;
      width: 90%;
      transition: border 0.18s;
    }
    input[type="password"]:focus {
      border: 1.5px solid #0077ff;
    }
    button {
      background: #0077ff;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.7em 2em;
      font-size: 1em;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.18s, transform 0.18s;
    }
    button:hover {
      background: #005fcc;
      transform: translateY(-2px) scale(1.03);
    }
    .error {
      color: #d32f2f;
      margin-bottom: 1em;
      font-size: 0.98em;
    }
    .secret-content {
      margin-top: 2em;
      color: #0077ff;
      font-size: 1.1em;
      font-weight: 600;
      display: none;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <h2>Admin prisijungimas</h2>
    <div id="error" class="error"></div>
    <input type="password" id="adminPass" placeholder="SlaptaÅ¾odis" />
    <br />
    <button onclick="checkPassword()">Prisijungti</button>
    <div id="secretContent" class="secret-content">
      <p>Slapta administratoriaus informacija! ðŸŽ‰</p>
      <form id="addGameForm" style="margin-top:2em;text-align:left;">
        <input type="hidden" id="editMode" value="" />
        <label>Kategorija:<br>
          <input type="text" id="gameCategory" placeholder="pvz. Vandens pramogos" required style="width:100%;margin-bottom:0.7em;" />
        </label><br>
        <label>Pavadinimas:<br>
          <input type="text" id="gameName" placeholder="Å½aidimo pavadinimas" required style="width:100%;margin-bottom:0.7em;" />
        </label><br>
        <label>ApraÅ¡ymas:<br>
          <textarea id="gameDesc" placeholder="Trumpas apraÅ¡ymas" required style="width:100%;margin-bottom:0.7em;"></textarea>
        </label><br>
        <label>Kaina:<br>
          <input type="text" id="gamePrice" placeholder="pvz. 40â‚¬ / val." required style="width:100%;margin-bottom:0.7em;" />
        </label><br>
        <label>Informacija (kaip vyks, kur rinktis ir pan.):<br>
          <textarea id="gameInfo" placeholder="Papildoma informacija" required style="width:100%;margin-bottom:0.7em;"></textarea>
        </label><br>
        <label>Nuotraukos:<br>
          <input type="file" id="gameImages" accept="image/*" multiple style="margin-bottom:0.7em;" />
        </label><br>
        <button type="submit">IÅ¡saugoti Å¾aidimÄ…</button>
        <button type="button" id="cancelEditBtn" style="display:none;margin-left:1em;">AtÅ¡aukti redagavimÄ…</button>
      </form>
      <div id="gamePreview" style="margin-top:2em;"></div>
      <hr style="margin:2em 0;">
      <h3>Visi Å¾aidimai pagal kategorijas</h3>
      <div id="adminGamesList"></div>
    </div>
  </div>
  <script>
    function checkPassword() {
      var pass = document.getElementById('adminPass').value;
      var error = document.getElementById('error');
      var secret = document.getElementById('secretContent');
      var correct = 'admin123';
      if (pass === correct) {
        error.textContent = '';
        secret.style.display = 'block';
        document.getElementById('adminPass').style.display = 'none';
        event.target.style.display = 'none';
        renderAdminGames();
      } else {
        error.textContent = 'Neteisingas slaptaÅ¾odis!';
        secret.style.display = 'none';
      }
    }

    // Helper: get/set categories in localStorage
    function getCategories() {
      const stored = localStorage.getItem('categories');
      if (stored) {
        try { return JSON.parse(stored); } catch { return []; }
      }
      return [];
    }
    function setCategories(cats) {
      localStorage.setItem('categories', JSON.stringify(cats));
    }

    // Render all games by category, with edit/delete
    function renderAdminGames() {
      var cats = getCategories();
      var out = '';
      if (!cats.length) {
        out = '<i>NÄ—ra Å¾aidimÅ³.</i>';
      } else {
        cats.forEach(function(cat, ci) {
          out += `<div style="margin-bottom:1.5em;"><b style='color:#0077ff;'>${cat.name}</b><ul style='padding-left:1em;'>`;
          (cat.games||[]).forEach(function(game, gi) {
            out += `<li style='margin-bottom:0.5em;'>
              <span style='font-weight:600;'>${game.name}</span> - ${game.price}<br>
              <span style='font-size:0.95em;color:#555;'>${game.description}</span><br>
              <button onclick='editGame(${ci},${gi})'>Redaguoti</button>
              <button onclick='deleteGame(${ci},${gi})' style='margin-left:0.5em;color:#d32f2f;'>IÅ¡trinti</button>
            </li>`;
          });
          out += '</ul></div>';
        });
      }
      document.getElementById('adminGamesList').innerHTML = out;
    }

    // Add game logic (with edit support)
    document.addEventListener('DOMContentLoaded', function() {
      var form = document.getElementById('addGameForm');
      if (!form) return;
      var preview = document.getElementById('gamePreview');
      var editModeInput = document.getElementById('editMode');
      var cancelEditBtn = document.getElementById('cancelEditBtn');
      form.onsubmit = function(e) {
        e.preventDefault();
        var category = document.getElementById('gameCategory').value.trim();
        var name = document.getElementById('gameName').value.trim();
        var desc = document.getElementById('gameDesc').value.trim();
        var price = document.getElementById('gamePrice').value.trim();
        var info = document.getElementById('gameInfo').value.trim();
        var imagesInput = document.getElementById('gameImages');
        var files = imagesInput.files;
        var isEdit = editModeInput.value !== '';
        if (!name || !desc || !price || !info || !category) {
          preview.innerHTML = '<span style="color:#d32f2f;">UÅ¾pildykite visus laukus.</span>';
          return;
        }
        if (!files.length && !isEdit) {
          preview.innerHTML = '<span style="color:#d32f2f;">PridÄ—kite bent vienÄ… nuotraukÄ….</span>';
          return;
        }
        var readers = [];
        var images = [];
        if (files.length) {
          for (let i = 0; i < files.length; i++) {
            readers.push(new Promise((resolve) => {
              var reader = new FileReader();
              reader.onload = function(ev) { resolve(ev.target.result); };
              reader.readAsDataURL(files[i]);
            }));
          }
        }
        Promise.all(readers).then(function(imgs) {
          images = imgs;
          var cats = getCategories();
          var catIdx = cats.findIndex(c => c.name === category);
          var gameObj = {
            name: name,
            description: desc,
            images: images.length ? images : (isEdit ? cats[catIdx].games[parseInt(editModeInput.value)].images : []),
            price: price,
            info: info
          };
          if (isEdit) {
            // Update existing game
            if (catIdx !== -1 && cats[catIdx].games[parseInt(editModeInput.value)]) {
              cats[catIdx].games[parseInt(editModeInput.value)] = gameObj;
              setCategories(cats);
              renderAdminGames();
              preview.innerHTML = '<span style="color:#388e3c;">Å½aidimas atnaujintas!</span>';
              form.reset();
              editModeInput.value = '';
              cancelEditBtn.style.display = 'none';
            }
          } else {
            // Add new game
            if (catIdx === -1) {
              cats.push({ key: category.toLowerCase().replace(/\s+/g,'-'), name: category, icon: '', games: [gameObj] });
            } else {
              cats[catIdx].games.push(gameObj);
            }
            setCategories(cats);
            renderAdminGames();
            preview.innerHTML = '<span style="color:#388e3c;">Å½aidimas pridÄ—tas!</span>';
            form.reset();
          }
        });
      };
      cancelEditBtn.onclick = function() {
        form.reset();
        editModeInput.value = '';
        cancelEditBtn.style.display = 'none';
        preview.innerHTML = '';
      };
    });

    // Edit game
    window.editGame = function(ci, gi) {
      var cats = getCategories();
      var game = cats[ci].games[gi];
      document.getElementById('gameCategory').value = cats[ci].name;
      document.getElementById('gameName').value = game.name;
      document.getElementById('gameDesc').value = game.description;
      document.getElementById('gamePrice').value = game.price;
      document.getElementById('gameInfo').value = game.info;
      document.getElementById('editMode').value = gi;
      document.getElementById('cancelEditBtn').style.display = 'inline-block';
      // Note: images cannot be edited here for simplicity, unless new ones are uploaded
    };
    // Delete game
    window.deleteGame = function(ci, gi) {
      if (!confirm('Ar tikrai iÅ¡trinti Å¾aidimÄ…?')) return;
      var cats = getCategories();
      cats[ci].games.splice(gi, 1);
      setCategories(cats);
      renderAdminGames();
    };
  </script>
</body>
</html>
