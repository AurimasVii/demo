<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Žaidimo informacija</title>
  <style>
    /* --- Copied from App.css for footer, side menu, and icons --- */
    body {
      background: #f9fbfd;
      font-family: 'Inter', 'Segoe UI', 'Roboto', Arial, sans-serif;
      color: #23272f;
      margin: 0;
      padding: 0;
    }
    .Footer {
      background: #fff;
      text-align: center;
      padding: 2vw 0 1vw 0;
      border-top: 1px solid #eaeaea;
      font-size: 1em;
      color: #888;
      margin-top: 3vw;
    }
    .FooterLinks {
      display: flex;
      justify-content: center;
      gap: 2vw;
      margin-bottom: 0.5em;
    }
    .FooterLinks a {
      color: #888;
      text-decoration: none;
      transition: color 0.18s;
      font-size: 1em;
      padding: 0.2em 0.6em;
      border-radius: 6px;
    }
    .FooterLinks a:hover {
      color: #0077ff;
      background: #f0f7ff;
    }
    .SocialIcon {
      width: 2.2em;
      height: 2.2em;
      min-width: 32px;
      min-height: 32px;
      max-width: 40px;
      max-height: 40px;
      object-fit: contain;
      filter: grayscale(0.2) brightness(0.97);
      transition: filter 0.18s, transform 0.18s;
      cursor: pointer;
      border-radius: 50%;
      background: #f5f7fa;
      padding: 0.2em;
      display: inline-block;
    }
    .SocialIcon:hover {
      filter: none;
      transform: scale(1.12);
      background: #e0e7ef;
    }
    .SideMenuDrawer {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 270px;
      background: #fff;
      box-shadow: 2px 0 16px rgba(0,0,0,0.08);
      z-index: 1200;
      transform: translateX(-110%);
      transition: transform 0.25s;
      display: flex;
      flex-direction: column;
      padding: 2em 1.2em 1em 1.2em;
    }
    .SideMenuDrawer.open {
      transform: translateX(0);
    }
    .SideMenuOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(30,40,60,0.10);
      z-index: 1199;
    }
    @media (max-width: 600px) {
      .Footer {
        font-size: 0.98em;
        padding: 2vw 0 2vw 0;
      }
      .FooterLinks {
        gap: 4vw;
      }
      .SideMenuDrawer {
        width: 90vw;
        min-width: 0;
        padding: 2em 1em 1em 1em;
      }
    }
    body {
      font-family: 'Inter', 'Segoe UI', 'Roboto', Arial, sans-serif;
      background: #f9fbfd;
      color: #23272f;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 420px;
      margin: 3vw auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 18px rgba(0,0,0,0.04);
      padding: 2vw 5vw 2vw 5vw;
      text-align: center;
    }
    h1 {
      color: #0077ff;
      font-size: 2em;
      margin-bottom: 0.2em;
    }
    .category {
      color: #888;
      font-size: 1em;
      margin-bottom: 1em;
    }
    .slider {
      position: relative;
      width: 100%;
      max-width: 320px;
      margin: 0 auto 1.5em auto;
      overflow: hidden;
      border-radius: 12px;
      background: #f8fafc;
      box-shadow: 0 2px 8px rgba(0,119,255,0.04);
    }
    .slider img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 12px;
      display: block;
    }
    .slider-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,119,255,0.7);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      font-size: 1.5em;
      cursor: pointer;
      z-index: 2;
      transition: background 0.18s;
    }
    .slider-btn:hover {
      background: #005fcc;
    }
    .slider-btn.left { left: 8px; }
    .slider-btn.right { right: 8px; }
    .price {
      color: #0077ff;
      font-weight: 600;
      margin-bottom: 0.7em;
      font-size: 1.1em;
    }
    .desc {
      color: #444;
      margin-bottom: 0.7em;
    }
    .info {
      color: #555;
      font-size: 0.98em;
      margin-bottom: 1.2em;
    }
    #reservationInfo {
      margin-top: 1.5em;
      padding: 1em;
      background: #f0f7ff;
      border-radius: 10px;
      color: #23272f;
      font-size: 1em;
      text-align: left;
    }
    #reserveBtn {
      background: #0077ff;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.7em 2em;
      font-size: 1em;
      font-weight: 500;
      cursor: pointer;
      margin: 1em 0 0 0;
    }
    @media (max-width: 600px) {
      .container {
        max-width: 98vw;
        padding: 4vw 2vw;
      }
      .slider img {
        height: 120px;
      }
    }
  </style>
</head>
<body>
  <button id="menuBtn" aria-label="Atidaryti meniu" style="position:fixed;top:20px;left:20px;z-index:1100;background:#0077ff;color:#fff;border:none;border-radius:50%;width:44px;height:44px;font-size:1.7em;cursor:pointer;box-shadow:0 2px 8px rgba(0,119,255,0.10);">&#9776;</button>
  <div id="sideMenuOverlay" class="SideMenuOverlay" style="display:none;"></div>
  <div id="sideMenuDrawer" class="SideMenuDrawer" style="display:none;">
    <button id="closeMenuBtn" style="position:absolute;top:18px;right:18px;background:none;border:none;font-size:2em;color:#bbb;cursor:pointer;">&times;</button>
    <div style="display:flex;align-items:center;gap:1em;margin-bottom:1.5em;">
      <img src="/logo192.png" alt="Logo" style="width:44px;height:44px;border-radius:12px;" />
      <span style="font-weight:600;font-size:1.2em;color:#0077ff;">Įmonės Pavadinimas</span>
    </div>
    <nav style="display:flex;flex-direction:column;gap:0.7em;margin-bottom:2em;">
      <a href="/" id="mainPageLink" style="text-decoration:none;color:#23272f;font-weight:500;">Pagrindinis</a>
      <a href="#apie" style="text-decoration:none;color:#23272f;font-weight:500;">Apie mus</a>
      <a href="#paslaugos" style="text-decoration:none;color:#23272f;font-weight:500;">Paslaugos</a>
      <a href="#uzsakymai" style="text-decoration:none;color:#23272f;font-weight:500;">Užsakymai</a>
    </nav>
    <div style="display:flex;gap:0.7em;margin-bottom:2em;">
      <a href="https://instagram.com/aurimasvi" target="_blank" rel="noopener"><img src="/icons/instagram.png" alt="Instagram" class="SocialIcon" /></a>
      <a href="https://facebook.com/aurimas.vizinis" target="_blank" rel="noopener"><img src="/icons/facebook.png" alt="Facebook" class="SocialIcon" /></a>
      <a href="https://mail.google.com/mail/?view=cm&to=aurimav05@gmail.com" target="_blank" rel="noopener"><img src="/icons/mail.png" alt="Gmail" class="SocialIcon" /></a>
    </div>
    <div style="border-top:1px solid #f2f4f8;margin:1em 0;"></div>
    <div style="font-weight:600;margin-bottom:0.7em;color:#23272f;">Kategorijos</div>
    <div id="sideMenuCategories" style="display:flex;flex-direction:column;gap:0.5em;"></div>
  </div>
  <div class="container">
    <h1 id="gameName"></h1>
    <div class="category" id="gameCategory"></div>
    <div class="slider" id="slider" style="position:relative;max-width:420px;margin:0 auto 1em auto;overflow:hidden;">
      <button id="sliderPrev" class="slider-btn left" style="display:none;position:absolute;top:50%;transform:translateY(-50%);z-index:2;">&#8592;</button>
      <img id="sliderImg" src="/icons/confetti.png" alt="Veiklos nuotrauka" style="width:100%;max-height:320px;object-fit:cover;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.07);background:#f7faff;">
      <button id="sliderNext" class="slider-btn right" style="display:none;position:absolute;top:50%;right:0;transform:translateY(-50%);z-index:2;">&#8594;</button>
      <div id="sliderDots" style="text-align:center;margin-top:0.7em;"></div>
    </div>
    <div class="price" id="gamePrice"></div>
    <div class="desc" id="gameDesc"></div>
    <div class="info" id="gameInfo"></div>
    <button id="reserveBtn" style="background:#0077ff;color:#fff;border:none;border-radius:8px;padding:0.7em 2em;font-size:1em;font-weight:500;cursor:pointer;margin:1em 0 0 0;">Rezervuoti</button>
    <div id="reservationInfo" style="margin-top:1.5em;padding:1em;background:#f0f7ff;border-radius:10px;color:#23272f;font-size:1em;text-align:left;"></div>
  </div>
  <footer class="Footer">
    <div class="FooterLinks">
      <a href="#kontaktai">Kontaktai</a>
      <a href="#privatumas">Privatumo politika</a>
      <a href="#taisykles">Naudojimosi taisyklės</a>
    </div>
    <p>&copy; Įmonės Pavadinimas</p>
  </footer>
  <div id="infoModal" style="display:none;position:fixed;z-index:2000;inset:0;background:rgba(30,40,60,0.18);align-items:center;justify-content:center;">
    <div id="infoContent" style="background:#fff;border-radius:18px;box-shadow:0 8px 32px rgba(0,119,255,0.10);padding:2.5vw 5vw;max-width:95vw;width:350px;position:relative;text-align:center;display:flex;flex-direction:column;align-items:center;">
      <button id="closeInfoModal" style="position:absolute;top:1em;right:1em;background:none;border:none;font-size:2em;color:#bbb;cursor:pointer;">&times;</button>
      <div id="infoBody"></div>
    </div>
  </div>
  <div id="reservationModal" style="display:none;position:fixed;z-index:3000;inset:0;background:rgba(30,40,60,0.18);align-items:center;justify-content:center;">
    <div id="reservationModalContent" style="background:#fff;border-radius:18px;box-shadow:0 8px 32px rgba(0,119,255,0.10);padding:2.5vw 5vw;max-width:95vw;width:350px;position:relative;text-align:center;display:flex;flex-direction:column;align-items:center;">
      <button id="closeReservationModal" style="position:absolute;top:1em;right:1em;background:none;border:none;font-size:2em;color:#bbb;cursor:pointer;">&times;</button>
      <h2 id="reservationModalTitle" style="color:#0077ff;font-weight:700;margin-bottom:0.7em;">Rezervacija</h2>
      <form id="reservationForm" style="width:100%;max-width:320px;display:flex;flex-direction:column;gap:0.7em;">
        <input type="text" name="name" placeholder="Jūsų vardas" required />
        <input type="email" name="email" placeholder="El. paštas" required />
        <input type="tel" name="phone" placeholder="Telefonas" required />
        <label style="margin-top:0.5em;font-weight:500;text-align:left;">Pasirinkite datą ir laiką:</label>
        <input type="date" name="date" required />
        <input type="time" name="time" required />
        <button type="submit" style="background:#0077ff;color:#fff;border:none;border-radius:8px;padding:0.7em 2em;font-size:1em;font-weight:500;cursor:pointer;margin-top:1em;">Rezervuoti</button>
      </form>
      <div id="reservationSuccess" style="display:none;color:#388e3c;font-weight:600;margin-top:1em;"></div>
      <div id="reservationError" style="display:none;color:#d32f2f;font-weight:600;margin-top:1em;"></div>
    </div>
  </div>
  <script>
    // Fetch activities from backend and render selected game
    const selectedGameId = localStorage.getItem('selectedGameId');
    // Use relative API endpoint for Vercel compatibility
    fetch('/api/activities')
      .then(res => res.json())
      .then(data => {
        // Group activities by category
        const grouped = {};
        data.forEach(act => {
          if (!grouped[act.category]) grouped[act.category] = [];
          grouped[act.category].push(act);
        });
        // Build categories array for side menu
        const cats = Object.keys(grouped).map(catName => ({
          key: catName.replace(/\s/g, '').toLowerCase(),
          name: catName,
          icon: {
            'Vandens pramogos': '/icons/swimming.png',
            'Renginių įrangos nuoma': '/icons/tools.png',
            'Pramogų vedimas': '/icons/confetti.png',
            'Lauko žaidimai': '/icons/park.png',
            'Vidaus pramogos': '/icons/cinema.png',
            'Šaudymo pramogos': '/icons/shooting-range.png'
          }[catName] || '/icons/confetti.png',
          games: grouped[catName]
        }));
        // Save to localStorage for admin/user flows
        localStorage.setItem('categories', JSON.stringify(cats));
        // Render side menu categories
        renderSideMenuCategories(cats);
        // Find and render selected game
        let game = null;
        if (selectedGameId) {
          // Try to find by _id (Mongo) or fallback to name
          game = data.find(g => g._id === selectedGameId) || data.find(g => g.name === selectedGameId);
        }
        if (!game) {
          document.querySelector('.container').innerHTML = '<p>Žaidimo informacija nerasta.</p>';
          return;
        }
        document.getElementById('gameName').textContent = game.name;
        document.getElementById('gameCategory').textContent = game.category || '';
        document.getElementById('gamePrice').textContent = 'Kaina: ' + (game.price || '');
        document.getElementById('gameDesc').textContent = game.description || '';
        document.getElementById('gameInfo').textContent = game.info || '';
        document.getElementById('reservationInfo').textContent = game.info || '';
        // Slidable photos (use array if available, else fallback to single image)
        let images = Array.isArray(game.images) && game.images.length ? game.images : (game.image ? [game.image] : []);
        let current = 0;
        const slider = document.getElementById('slider');
        slider.innerHTML = `<button class="slider-btn left" id="prevBtn">&#8592;</button><img id="sliderImg" src="" alt="Žaidimo nuotrauka" /><button class="slider-btn right" id="nextBtn">&#8594;</button>`;
        const sliderImg = document.getElementById('sliderImg');
        function showImg(idx) {
          if (images.length > 0) {
            sliderImg.src = images[idx];
            sliderImg.style.display = '';
          } else {
            sliderImg.src = '';
            sliderImg.style.display = 'none';
          }
        }
        showImg(current);
        document.getElementById('prevBtn').onclick = function() {
          if (images.length > 0) {
            current = (current - 1 + images.length) % images.length;
            showImg(current);
          }
        };
        document.getElementById('nextBtn').onclick = function() {
          if (images.length > 0) {
            current = (current + 1) % images.length;
            showImg(current);
          }
        };
        document.getElementById('reserveBtn').onclick = function() {
          document.getElementById('reservationModal').style.display = 'flex';
          document.getElementById('reservationSuccess').style.display = 'none';
          document.getElementById('reservationError').style.display = 'none';
          document.getElementById('reservationForm').reset();
        };
        document.getElementById('closeReservationModal').onclick = function() {
          document.getElementById('reservationModal').style.display = 'none';
        };
        document.getElementById('reservationModal').onclick = function(e) {
          if (e.target === this) this.style.display = 'none';
        };
        document.getElementById('reservationForm').onsubmit = function(e) {
          e.preventDefault();
          const form = e.target;
          const reservation = {
            activityId: game._id,
            name: form.name.value,
            email: form.email.value,
            phone: form.phone.value,
            date: form.date.value,
            time: form.time.value
          };
          fetch('/api/reservations', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(reservation)
          })
            .then(res => res.json())
            .then(() => {
              document.getElementById('reservationSuccess').textContent = 'Rezervacija sėkmingai pateikta!';
              document.getElementById('reservationSuccess').style.display = 'block';
              document.getElementById('reservationError').style.display = 'none';
              form.reset();
            })
            .catch(() => {
              document.getElementById('reservationError').textContent = 'Klaida pateikiant rezervaciją.';
              document.getElementById('reservationError').style.display = 'block';
              document.getElementById('reservationSuccess').style.display = 'none';
            });
        };
      });
    document.getElementById('menuBtn').onclick = function() {
      document.getElementById('sideMenuDrawer').style.display = 'flex';
      setTimeout(function() {
        document.getElementById('sideMenuDrawer').classList.add('open');
        document.getElementById('sideMenuOverlay').style.display = 'block';
      }, 10);
    };
    document.getElementById('closeMenuBtn').onclick = function() {
      document.getElementById('sideMenuDrawer').classList.remove('open');
      setTimeout(function() {
        document.getElementById('sideMenuDrawer').style.display = 'none';
        document.getElementById('sideMenuOverlay').style.display = 'none';
      }, 250);
    };
    document.getElementById('sideMenuOverlay').onclick = function() {
      document.getElementById('closeMenuBtn').onclick();
    };
    // Render categories in side menu
    function renderSideMenuCategories(cats) {
      if (!cats) cats = JSON.parse(localStorage.getItem('categories') || '[]');
      var out = '';
      cats.forEach(function(cat) {
        out += `<a href="#${cat.key}" class="sideMenuCatLink" data-cat="${cat.key}" style="display:flex;align-items:center;gap:0.7em;text-decoration:none;color:#0077ff;font-weight:500;padding:0.4em 0;border-radius:8px;"><img src="${cat.icon || 'logo192.png'}" alt="${cat.name}" style="width:32px;height:32px;border-radius:8px;object-fit:contain;background:#f8fafc;" /><span>${cat.name}</span></a>`;
      });
      document.getElementById('sideMenuCategories').innerHTML = out;
      // Add click listeners for category links to redirect and scroll
      Array.from(document.querySelectorAll('.sideMenuCatLink')).forEach(function(link) {
        link.onclick = function(e) {
          e.preventDefault();
          var catKey = link.getAttribute('data-cat');
          // Save to localStorage for main page scroll
          localStorage.setItem('scrollToCategory', catKey);
          localStorage.setItem('scrollSmooth', '1');
          window.location.href = '/#' + catKey;
        };
      });
    }
    const infoContent = {
      apie: {title: 'Apie mus', body: '<p>Esame pramogų ir renginių organizavimo komanda, siekianti suteikti nepamirštamų įspūdžių visiems savo klientams. Mūsų tikslas – padėti žmonėms atrasti naujas veiklas, patirti nuotykių ir kurti bendrystės akimirkas.</p>'},
      paslaugos: {title: 'Paslaugos', body: '<p>Siūlome įvairias pramogas, renginių įrangos nuomą, žaidimų vedimą, lauko ir vidaus žaidimus, šaudymo pramogas bei kitas paslaugas tiek vaikams, tiek suaugusiems.</p>'},
      uzsakymai: {title: 'Užsakymai', body: '<p>Norėdami užsisakyti paslaugą ar rezervuoti veiklą, pasirinkite norimą žaidimą ir užpildykite rezervacijos formą. Gavę užklausą, su jumis susisieksime patvirtinti užsakymą.</p>'},
      kontaktai: {title: 'Kontaktai', body: '<p>El. paštas: <a href="mailto:aurimav05@gmail.com">aurimav05@gmail.com</a><br>Instagram: <a href="https://instagram.com/aurimasvi" target="_blank" rel="noopener">@aurimasvi</a><br>Facebook: <a href="https://facebook.com/aurimas.vizinis" target="_blank" rel="noopener">Aurimas Vižinis</a></p>'},
      privatumas: {title: 'Privatumo politika', body: '<p>Jūsų asmens duomenys yra saugūs ir naudojami tik užsakymų administravimui bei komunikacijai. Duomenys neperduodami trečiosioms šalims be jūsų sutikimo.</p>'},
      taisykles: {title: 'Naudojimosi taisyklės', body: '<p>Naudodamiesi svetaine, sutinkate su mūsų paslaugų teikimo sąlygomis. Prašome atsakingai pateikti savo duomenis ir laikytis nurodytų rezervacijos bei dalyvavimo taisyklių.</p>'}
    };
    function openInfoModal(key) {
      document.getElementById('infoBody').innerHTML = `<h2 style='color:#0077ff;font-weight:700;margin-bottom:0.7em;'>${infoContent[key].title}</h2>${infoContent[key].body}`;
      document.getElementById('infoModal').style.display = 'flex';
    }
    document.getElementById('closeInfoModal').onclick = function() {
      document.getElementById('infoModal').style.display = 'none';
    };
    // Add listeners to side menu and footer links:
    ['apie','paslaugos','uzsakymai','kontaktai','privatumas','taisykles'].forEach(function(key) {
      const link = document.querySelector(`a[href="#${key}"]`);
      if (link) {
        link.onclick = function(e) {
          e.preventDefault();
          openInfoModal(key);
          if(document.getElementById('sideMenuDrawer')) document.getElementById('sideMenuDrawer').style.display = 'none';
          if(document.getElementById('sideMenuOverlay')) document.getElementById('sideMenuOverlay').style.display = 'none';
        };
      }
    });
    // Add listeners for footer links as well
    ['kontaktai','privatumas','taisykles'].forEach(function(key) {
      const link = document.querySelector(`.FooterLinks a[href="#${key}"]`);
      if (link) {
        link.onclick = function(e) {
          e.preventDefault();
          openInfoModal(key);
        };
      }
    });
    // Side menu open/close logic (unchanged)
    document.getElementById('mainPageLink').onclick = function(e) {
      e.preventDefault();
      window.location.href = '/';
    };
    // Smooth redirect to main page and scroll to category
    function goToCategory(catKey) {
      localStorage.setItem('scrollToCategory', catKey);
      localStorage.setItem('scrollSmooth', '1');
      window.location.href = '/'; // Use root, not /index.html
    }
    // Example: attach to category links in side menu
    document.addEventListener('DOMContentLoaded', function() {
      const catLinks = document.querySelectorAll('[data-category-key]');
      catLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          goToCategory(this.getAttribute('data-category-key'));
        });
      });
    });
    // Responsive image slider logic
    let sliderImages = [];
    let sliderIdx = 0;
    function showSliderImg(idx) {
      if (!sliderImages.length) return;
      sliderIdx = (idx + sliderImages.length) % sliderImages.length;
      document.getElementById('sliderImg').src = sliderImages[sliderIdx];
      // Dots
      const dots = sliderImages.map((_,i)=>`<span style="display:inline-block;width:10px;height:10px;margin:0 3px;border-radius:50%;background:${i===sliderIdx?'#0077ff':'#e0e7ef'};cursor:pointer;" data-dot-idx="${i}"></span>`).join('');
      document.getElementById('sliderDots').innerHTML = dots;
      // Show/hide arrows
      document.getElementById('sliderPrev').style.display = sliderImages.length>1?'block':'none';
      document.getElementById('sliderNext').style.display = sliderImages.length>1?'block':'none';
    }
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('sliderPrev').onclick = ()=>showSliderImg(sliderIdx-1);
      document.getElementById('sliderNext').onclick = ()=>showSliderImg(sliderIdx+1);
      document.getElementById('sliderDots').onclick = function(e) {
        if (e.target.dataset.dotIdx) showSliderImg(Number(e.target.dataset.dotIdx));
      };
      // Touch support for mobile
      let touchStartX = 0;
      document.getElementById('sliderImg').addEventListener('touchstart',e=>{touchStartX=e.touches[0].clientX;});
      document.getElementById('sliderImg').addEventListener('touchend',e=>{
        const dx = e.changedTouches[0].clientX-touchStartX;
        if (Math.abs(dx)>40) showSliderImg(sliderIdx-(dx>0?1:-1));
      });
      // If activity images are available, call loadActivityImages here
      if (window.activityImagesForSlider) {
        loadActivityImages(window.activityImagesForSlider);
      }
    });
    // When loading activity, set sliderImages and show first
    function loadActivityImages(images) {
      sliderImages = (images && images.length ? images.slice() : ['/icons/confetti.png']);
      showSliderImg(0);
    }
  </script>
</body>
</html>
